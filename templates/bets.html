<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Luc Habaraken Betting Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #121212;
        color: #eee;
        margin: 0;
        padding: 20px;
        transition: 0.3s;
      }
      body.light {
        background: #f4f4f4;
        color: #222;
      }
      h1 {
        text-align: center;
        margin: 10px 0;
      }
      button {
        padding: 8px 14px;
        margin: 5px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.2s;
      }
      button:hover {
        transform: scale(1.05);
        box-shadow: 0 0 8px #4caf50;
      }
      .theme-toggle {
        background: #2196f3;
        color: white;
      }
      .shadow-toggle {
        background: #f44336;
        color: white;
      }
      .shadow-toggle.active {
        opacity: 0.5;
      }

      .filters {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin: 10px 0;
        align-items: center;
      }
      .filters select,
      .filters input {
        padding: 5px;
        border-radius: 5px;
        border: 1px solid #555;
      }
      .filters button {
        padding: 5px 10px;
        border-radius: 5px;
        background: #4caf50;
        color: white;
        border: none;
        cursor: pointer;
      }

      .kpis {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
      }
      .kpi {
        background: #1e1e1e;
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        min-width: 130px;
        transition: 0.3s;
      }
      .kpi:hover {
        box-shadow: 0 0 15px #4caf50;
      }
      body.light .kpi {
        background: #fff;
      }
      .kpi h3 {
        margin: 0;
        font-size: 1.1rem;
      }
      .kpi p {
        margin: 5px 0 0;
        font-size: 0.95rem;
      }
      .pulse {
        animation: pulseGlow 0.6s ease;
      }
      @keyframes pulseGlow {
        0% {
          box-shadow: 0 0 5px #4caf50;
        }
        50% {
          box-shadow: 0 0 15px #4caf50;
        }
        100% {
          box-shadow: 0 0 5px #4caf50;
        }
      }

      .charts {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        margin-bottom: 20px;
        justify-content: center;
      }
      .chart-container {
        width: 100%;
        max-width: 400px;
        height: 200px;
        padding: 10px;
        border-radius: 10px;
        background: #1e1e1e;
        transition: 0.3s;
      }
      .chart-container:hover {
        transform: translateY(-5px);
        box-shadow: 0 0 12px #2196f3;
      }
      body.light .chart-container {
        background: #fff;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }
      th,
      td {
        border: 1px solid #555;
        padding: 5px;
        text-align: center;
        font-size: 0.8rem;
        transition: 0.3s;
      }
      th {
        background: #333;
      }
      body.light th {
        background: #ccc;
        border-color: #aaa;
      }
      tr:hover {
        cursor: pointer;
        box-shadow: 0 0 12px #4caf50;
      }
      .status-open {
        color: #2196f3;
        font-weight: bold;
      }
      .status-won {
        color: #4caf50;
        font-weight: bold;
      }
      .status-lost {
        color: #f44336;
        font-weight: bold;
      }
      .status-void {
        color: orange;
        font-weight: bold;
      }

      .errors {
        margin-top: 20px;
        padding: 10px;
        background: #1e1e1e;
        border-radius: 10px;
        max-height: 150px;
        overflow-y: auto;
        transition: 0.3s;
      }
      .errors li {
        transition: 0.3s;
        padding: 2px 5px;
      }
      .errors li:hover {
        box-shadow: 0 0 10px #f44336;
      }
      body.light .errors {
        background: #fff;
      }

      @media (max-width: 768px) {
        .kpis {
          flex-direction: column;
          align-items: center;
        }
        .charts {
          flex-direction: column;
          align-items: center;
        }
      }
    </style>
  </head>
  <body>
    <h1>Luc Habaraken Betting Dashboard</h1>

    <div class="filters">
      <button class="theme-toggle" onclick="toggleTheme()">
        Toggle Light/Dark
      </button>
      <button id="shadowBtn" class="shadow-toggle" onclick="toggleShadow()">
        Demo Mode
      </button>
      <select id="sportFilter" onchange="refreshDashboard()">
        <option value="">All Sports</option>
        <option value="Football">Football</option>
        <option value="Tennis">Tennis</option>
      </select>
      <select id="statusFilter" onchange="refreshDashboard()">
        <option value="">All Status</option>
        <option value="Open">Open</option>
        <option value="Won">Won</option>
        <option value="Lost">Lost</option>
        <option value="Void">Void</option>
      </select>
      <input
        type="number"
        id="minEdgeFilter"
        placeholder="Min Edge %"
        oninput="refreshDashboard()"
      />
      <select id="stakingMethod">
        <option value="flat">Flat</option>
        <option value="kelly">Kelly</option>
      </select>
      <button onclick="exportCSV()">Export CSV</button>
    </div>

    <div class="kpis">
      <div class="kpi">
        <h3>Bankroll</h3>
        <p id="bankroll">0</p>
      </div>
      <div class="kpi">
        <h3>ROI %</h3>
        <p id="roi">0%</p>
      </div>
      <div class="kpi">
        <h3>CLV %</h3>
        <p id="clv">0%</p>
      </div>
      <div class="kpi">
        <h3>Turnover</h3>
        <p id="turnover">0</p>
      </div>
      <div class="kpi">
        <h3>Drawdown</h3>
        <p id="drawdown">0</p>
      </div>
    </div>

    <div class="charts">
      <div class="chart-container"><canvas id="roiChart"></canvas></div>
      <div class="chart-container"><canvas id="bankrollChart"></canvas></div>
    </div>

    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Timestamp</th>
          <th>Sport</th>
          <th>Market</th>
          <th>Placed Odds</th>
          <th>Closing Odds</th>
          <th>CLV %</th>
          <th>Probability</th>
          <th>Edge</th>
          <th>Stake</th>
          <th>Result</th>
        </tr>
      </thead>
      <tbody id="betsTable"></tbody>
    </table>

    <div class="errors">
      <h3>Error Logs</h3>
      <ul id="errorLogs"></ul>
    </div>

    <script>
      // === State ===
      let bets = [],
        bankroll = 1000,
        peakBankroll = 1000,
        totalBets = 0,
        shadowMode = true,
        intervalId;
      const sportsList = ["Football", "Tennis"];
      const resultsList = ["Open", "Won", "Lost", "Void"];

      // === Random Bet Generator ===
      function randomBet() {
        const sport = sportsList[Math.floor(Math.random() * sportsList.length)];
        const result =
          resultsList[Math.floor(Math.random() * resultsList.length)];
        const id = ++totalBets;
        const timestamp = new Date().toLocaleTimeString();
        const market = `${sport} Match`;
        const placedOdds = (Math.random() * 3 + 1).toFixed(2);
        const closingOdds = (Math.random() * 3 + 1).toFixed(2);
        const clv = (((closingOdds - placedOdds) / placedOdds) * 100).toFixed(
          2
        );
        const probability = (Math.random() * 0.5 + 0.25).toFixed(2);
        const edge = (Math.random() * 10).toFixed(2);
        const stake = 10 + Math.floor(Math.random() * 50);
        return {
          id,
          timestamp,
          sport,
          match: market,
          placedOdds,
          closingOdds,
          clv,
          probability,
          edge,
          bet_amount: stake,
          result,
        };
      }

      // === Error Logging ===
      function logError(msg) {
        const ul = document.getElementById("errorLogs");
        const li = document.createElement("li");
        li.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
        li.onmouseover = () => (li.style.boxShadow = "0 0 10px #f44336");
        li.onmouseout = () => (li.style.boxShadow = "none");
        ul.appendChild(li);
        ul.scrollTop = ul.scrollHeight;
      }

      // === Theme & Demo Toggle ===
      function toggleTheme() {
        document.body.classList.toggle("light");
      }
      function toggleShadow() {
        shadowMode = !shadowMode;
        const btn = document.getElementById("shadowBtn");
        btn.textContent = shadowMode ? "Demo Mode" : "Live Mode";
        btn.classList.toggle("active");
        if (shadowMode) startBets();
        else stopBets();
      }

      // === Filters ===
      function getFilteredBets() {
        const sport = document.getElementById("sportFilter").value;
        const status = document.getElementById("statusFilter").value;
        const minEdge =
          parseFloat(document.getElementById("minEdgeFilter").value) || 0;
        return bets.filter(
          (b) =>
            (!sport || b.sport === sport) &&
            (!status || b.result === status) &&
            b.edge >= minEdge
        );
      }

      // === Dashboard Refresh ===
      let roiChart, bankrollChart;
      function refreshDashboard() {
        const filtered = getFilteredBets();
        const tbody = document.getElementById("betsTable");
        tbody.innerHTML = "";
        filtered.forEach((b) => {
          tbody.innerHTML += `<tr class="status-${b.result.toLowerCase()}">
      <td>${b.id}</td><td>${b.timestamp}</td><td>${b.sport}</td><td>${
            b.match
          }</td>
      <td>${b.placedOdds}</td><td>${b.closingOdds}</td><td>${b.clv}%</td>
      <td>${(b.probability * 100).toFixed(0)}%</td><td>${b.edge}%</td>
      <td>${b.bet_amount}</td><td class="status-${b.result.toLowerCase()}">${
            b.result
          }</td>
    </tr>`;
        });

        const turnover = filtered.reduce(
          (s, b) => s + parseFloat(b.bet_amount),
          0
        );
        const roiVal = turnover
          ? (((bankroll - 1000) / turnover) * 100).toFixed(2)
          : 0;
        const avgCLV = filtered.length
          ? (
              filtered.reduce((s, b) => s + parseFloat(b.clv), 0) /
              filtered.length
            ).toFixed(2)
          : 0;
        const drawdown = (peakBankroll - bankroll).toFixed(2);

        ["bankroll", "roi", "clv", "turnover", "drawdown"].forEach((id) => {
          const el = document.getElementById(id);
          el.textContent =
            { bankroll, roi: roiVal, clv: avgCLV, turnover, drawdown }[id] +
            (id === "roi" || id === "clv" ? "%" : "");
          el.classList.add("pulse");
          setTimeout(() => el.classList.remove("pulse"), 500);
        });

        const labels = filtered.map((b) => b.id);
        const roiData = filtered.map(() => roiVal);
        const bankrollData = filtered.map(() => bankroll.toFixed(2));
        const options = {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { labels: { color: "#eee" } } },
          scales: {
            x: { ticks: { color: "#eee" } },
            y: { ticks: { color: "#eee" } },
          },
        };
        if (!roiChart)
          roiChart = new Chart(document.getElementById("roiChart"), {
            type: "line",
            data: {
              labels,
              datasets: [
                {
                  label: "ROI %",
                  data: roiData,
                  borderColor: "#4caf50",
                  fill: true,
                },
              ],
            },
            options,
          });
        else {
          roiChart.data.labels = labels;
          roiChart.data.datasets[0].data = roiData;
          roiChart.update();
        }

        if (!bankrollChart)
          bankrollChart = new Chart(document.getElementById("bankrollChart"), {
            type: "line",
            data: {
              labels,
              datasets: [
                {
                  label: "Bankroll",
                  data: bankrollData,
                  borderColor: "#2196f3",
                  fill: true,
                },
              ],
            },
            options,
          });
        else {
          bankrollChart.data.labels = labels;
          bankrollChart.data.datasets[0].data = bankrollData;
          bankrollChart.update();
        }
      }

      // === Export CSV ===
      function exportCSV() {
        let csv =
          "ID,Timestamp,Sport,Market,Placed Odds,Closing Odds,CLV %,Probability,Edge,Stake,Result\n";
        getFilteredBets().forEach((b) => {
          csv += `${b.id},${b.timestamp},${b.sport},${b.match},${
            b.placedOdds
          },${b.closingOdds},${b.clv}%,${(b.probability * 100).toFixed(0)}%,${
            b.edge
          }%,${b.bet_amount},${b.result}\n`;
        });
        const blob = new Blob([csv], { type: "text/csv" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "bets.csv";
        a.click();
        URL.revokeObjectURL(url);
      }

      // === Betting Interval ===
      function generateBet() {
        const newBet = randomBet();
        bets.push(newBet);
        if (newBet.result === "Won")
          bankroll += newBet.bet_amount * (newBet.placedOdds - 1);
        else if (newBet.result === "Lost") bankroll -= newBet.bet_amount;
        if (bankroll > peakBankroll) peakBankroll = bankroll;
        if (Math.random() < 0.3) logError(`Random error on bet ${newBet.id}`);
        refreshDashboard();
      }
      function startBets() {
        intervalId = setInterval(generateBet, 3000);
      }
      function stopBets() {
        clearInterval(intervalId);
      }

      // === Init ===
      document.addEventListener("DOMContentLoaded", () => {
        startBets();
        refreshDashboard();
      });
    </script>
  </body>
</html>
